<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Babel: a Dictionary for Panhuman Image-Based Language</title>
		<link rel="stylesheet/less" type="text/css" href="css/babel.less" />
		<script src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
		<script src="js/less-1.3.0.min.js" type="text/javascript"></script>
		<script>
			if(localStorage.twitterSearch) {//twitterSearch is a property of localStorage; can be named anything
				var twitterData = JSON.parse(localStorage.twitterSearch),
					formattedTweets = [];
				$.each(twitterData.results, function(index, tweet) {
					var id = tweet.id_str,
						text = tweet.text,
						author = tweet.from_user;
					window.term = tweet.text;
					formattedTweets.push({ //save only the data you want
						id: id,
						text: text,
						author: author
					});
				});
				localStorage.formattedTweets = JSON.stringify(formattedTweets);
			} else { //if the information does not exist in the cache, do this (add it, which is defined in the success property function)
				var data;
				$.ajax({
					url: 'http://search.twitter.com/search.json?q=%E3%82%B7%20OR%20%E3%81%A3%20OR%20%E3%83%8F%20OR%20%E3%81%A1%20OR%20(%E0%AB%80%20OR%20%E3%81%93%20OR%20%E0%B1%AA%20OR%20%E2%97%9E%E0%B8%B4%20OR%20%E2%97%9F%E0%B8%B4%20OR%20%E2%9A%97%E0%B8%B1%20lang%3Aen&rpp=1',
					dataType:'jsonp',
					success:function(response) {//has to be called "response"
						localStorage.twitterSearch = JSON.stringify(response); //response has to be wrapped in this to convert the object to a string
					},
					error: function(error){//should pass the actual error that was encountered
						console.log(error);
					}
				});	
			}
			//Get google images
			if(localStorage.imageSearch) {
				var imageResults = JSON.parse(localStorage.imageSearch),
					formattedImages = [];
				$.each(imageResults.items, function(index, value) {
					var imgUrl = value.link;
					formattedImages.push({
						imgUrl : imgUrl
					});
				});
				localStorage.formattedImages = JSON.stringify(formattedImages);
			} else {
				var query = "(∏ ω ∏)"; //Needs to be changed to the filtered term from tweet text
				window.term = query;
				$.ajax({
					url: 'https://www.googleapis.com/customsearch/v1?key=AIzaSyC3j0IL8MvOHlnJyxlvVBtV516H_GWm9w0&cx=013127619618331965896:basxoxgd-ce&q='+query+'&searchType=image', //figure out how to limit search results
					dataType:'jsonp',
					success:function(response){
						localStorage.imageSearch = JSON.stringify(response);
						console.log(response);
					}
				});
			}
			$(document).ready(function() {
				$.each(formattedImages, function(index, value) {
					var imgUrl = value.imgUrl,
						defBlock = "<li><div></div><img src='"+imgUrl+"' /></li>";
					$('#defContainer').append(defBlock);
				});
				$.each(formattedTweets, function(index, value) {
					var tweet = value.text,
						author = value.author,
						id = value.id,
						url = "http://twitter.com/"+author+"/status/"+id,
						contextBlock = "<li>"+tweet+" <a href='"+url+"' target='_blank'>➚</a></li>";
					$('#contextContainer').append(contextBlock);
				});
				$('#defContainer > li > div').hide();			
				$('#defContainer > li').mouseenter(function() {
					jQuery(this).children('div').show();
				}).mouseleave(function() {
					jQuery(this).children('div').hide();
				}).click(function() {
					jQuery(this).remove();
				});
			});
		</script>
	</head>
	<body>
		<div id="navigation">
			<li><a href="#" class="active">Contribute</a></li>
			<li><a href="#">Search</a></li>
			<li><a href="#">View Current Dictionary</a></li>
			<li><a href="#">About</a></li>
			<form id="search">
				<input type="text" value="Search the dictionary" name="search" />
			</form>
		</div>
		<div id="container">
			<header>
				<a href="index.php"><img src="images/logo.png" /></a>
				<span class="tagline">A dictionary for panhuman image-based language</span>
			</header>
			<article id="content">
				<section id="instruction">
					<div class="text">Help define this symbol:</div>
					<div class="term">
						(∏ ω ∏)
					</div>
					<div class="text">Click to remove images that do not define the above term.</div>
				</section>
				<section id="entry">
					<ol id="defContainer">
						
					</ol>
					<h2>Usage & Context:</h2>
					<ol id="contextContainer">
						
					</ol>
				</section>
				<section id="decision">
					<a class="accept" href="#">Accept this definition</a>
					<a class="deny" href="#">Throw away this term</a>
				</section>
			</article>
		</div>
	</body>
</html>